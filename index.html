<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCM Notification Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .granted {
            background-color: #d4edda;
            color: #155724;
        }
        .denied {
            background-color: #f8d7da;
            color: #721c24;
        }
        .default {
            background-color: #e2e3e5;
            color: #383d41;
        }
        #token {
            word-break: break-all;
            margin: 20px auto;
            max-width: 80%;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-messaging-compat.js"></script>
</head>
<body>
    <h1>Firebase Cloud Messaging</h1>
    <div id="status" class="status default">Checking notification permission...</div>
    <div id="token" style="display:none;"></div>
    <p>This page will automatically request notification permission after 30 seconds.</p>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD6g1-cHCBJ-lhwFrr8L1ANehyGwkHjw6k",
        authDomain: "hospital-47fce.firebaseapp.com",
        projectId: "hospital-47fce",
        storageBucket: "hospital-47fce.appspot.com",
        messagingSenderId: "54581383019",
        appId: "1:54581383019:web:07333ea8bf1594999b062e",
        measurementId: "G-4EB69QFJDZ"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        document.addEventListener('DOMContentLoaded', function() {
            // Check current permission status
            checkNotificationPermission();
            
            // Request permission after 30 seconds
            setTimeout(requestNotificationPermission, 30000);
        });

        function checkNotificationPermission() {
            if (!('Notification' in window)) {
                updateStatus('Notifications are not supported in this browser');
                return;
            }

            Notification.requestPermission().then(function(permission) {
                updateStatus(permission);
                if (permission === 'granted') {
                    getFCMToken();
                }
            });
        }

        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                updateStatus('Notifications are not supported in this browser');
                return;
            }

            if (Notification.permission === 'default') {
                Notification.requestPermission().then(function(permission) {
                    updateStatus(permission);
                    if (permission === 'granted') {
                        getFCMToken();
                    }
                });
            } else {
                updateStatus(Notification.permission);
                if (Notification.permission === 'granted') {
                    getFCMToken();
                }
            }
        }

        function updateStatus(status) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = 'Notification permission: ' + status;
            
            // Remove all classes
            statusElement.className = 'status';
            
            // Add appropriate class based on status
            if (status === 'granted') {
                statusElement.classList.add('granted');
            } else if (status === 'denied') {
                statusElement.classList.add('denied');
            } else {
                statusElement.classList.add('default');
            }
        }

        function getFCMToken() {
            messaging.getToken({ vapidKey: 'BGuXSlrCG8FEsOSw6muHfsb5yFvHstKf-QqSbVtc_pqnz1dWmkUVZBSGnlj7hb71P2vqciBcANv70Ps1Y4F7XL8' }).then((currentToken) => {
                if (currentToken) {
                    console.log('FCM Token:', currentToken);
                    const tokenElement = document.getElementById('token');
                    tokenElement.textContent = 'FCM Token: ' + currentToken;
                    tokenElement.style.display = 'block';
                    
                    // Here you would typically send this token to your server
                    // sendTokenToServer(currentToken);
                } else {
                    console.log('No registration token available. Request permission to generate one.');
                }
            }).catch((err) => {
                console.log('An error occurred while retrieving token. ', err);
            });
        }

        // Handle incoming messages
        messaging.onMessage((payload) => {
            console.log('Message received. ', payload);
            const notificationTitle = payload.notification.title;
            const notificationOptions = {
                body: payload.notification.body,
                icon: payload.notification.icon || '/firebase-logo.png'
            };
            
            new Notification(notificationTitle, notificationOptions);
        });
    </script>
</body>
</html>
